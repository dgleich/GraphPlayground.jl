@testset "d3-compare" begin 
  function initgrid()
    #= 
    ## Setup a demo to understand any differences from d3-force
    using Graphs
    g = grid([5,5])

    foreach(edges(g)) do e
      println("  links.push({source: ", e.src-1, ", target: ", e.dst-1, "});")
    end 

    using GraphPlayground, GeometryBasics, GLMakie
    sim = ForceSimulation(Point2f, vertices(g); )

    foreach(1:nv(g)) do i
      println("  nodes[$(i-1)].x = ", sim.positions[i][1], "; nodes[$(i-1)].y = ", sim.positions[i][2], ";")
    end

    # get the same info for julia
    @show sim.positions
    foreach(edges(g)) do e 
      print("Edge(", e.src, ", ", e.dst, "), ")
    end 
    =# 
    # record the same positions... 
    pos = Point{2, Float32}[[0.47453555, 2.7263865], [1.4919398, 3.7412186], [0.96295494, 1.5611136], [0.6828322, 1.2432957], [3.2857077, 3.1859443], [2.7603805, 3.6410117], [2.2274709, 4.0740123], [1.2668705, 3.296721], [4.502468, 2.8802135], [1.3515131, 2.8808281], [4.6283107, 2.116446], [4.057611, 2.5923073], [4.4946713, 1.3253814], [3.113631, 2.373382], [0.3633141, 0.8325094], [4.2768054, 4.4309807], [2.838262, 3.7632565], [2.992505, 3.0753062], [3.5060213, 1.3894404], [0.336989, 4.3687134], [3.417117, 4.4206443], [4.4303355, 0.97814], [3.7498107, 4.703241], [2.1663282, 4.306034], [4.8099008, 3.191344]]
    edgelist = [Edge(1, 2), Edge(1, 6), Edge(2, 3), Edge(2, 7), Edge(3, 4), Edge(3, 8), Edge(4, 5), Edge(4, 9), Edge(5, 10), Edge(6, 7), Edge(6, 11), Edge(7, 8), Edge(7, 12), Edge(8, 9), Edge(8, 13), Edge(9, 10), Edge(9, 14), Edge(10, 15), Edge(11, 12), Edge(11, 16), Edge(12, 13), Edge(12, 17), Edge(13, 14), Edge(13, 18), Edge(14, 15), Edge(14, 19), Edge(15, 20), Edge(16, 17), Edge(16, 21), Edge(17, 18), Edge(17, 22), Edge(18, 19), Edge(18, 23), Edge(19, 20), Edge(19, 24), Edge(20, 25), Edge(21, 22), Edge(22, 23), Edge(23, 24), Edge(24, 25)]
    g = SimpleGraph(edgelist)
    return g, pos 
  end 

  function test_sim(sim; d3pos, d3vel, steps=1)
    for _ in 1:steps
      step!(sim)
    end
    for i in sim.nodes
      @testset "Node $i" begin 
        @test sim.positions[i] ≈ d3pos[i] 
        @test sim.velocities[i] ≈ d3vel[i] 
      end
    end
  end

  @testset "linkforce" begin 
    @testset "case1" begin 
      g, pos = initgrid()
      test_sim(
        ForceSimulation(pos, vertices(g); 
          link=LinkForce(edges=edges(g), strength=1, distance=20, iterations=1), 
        ); 
        d3pos = [Point2f(-5.966415475914804, -3.4499377025253772), 
        Point2f(8.299699348928659, 11.410562949114803), 
        Point2f(-4.762231255541469, -6.049689968864188), 
        Point2f(6.044201798355603, 11.142251206712338), 
        Point2f(-0.15250354553109213, -5.778486353853048), 
        Point2f(9.270730012878964, 9.920014398738353), 
        Point2f(-5.094467013216385, -2.7054723380993106), 
        Point2f(5.295379659245205, 11.543803363595138), 
        Point2f(2.5131667630815775, -6.599988471925734), 
        Point2f(2.758800465233053, 10.567724183438239), 
        Point2f(-0.6244904844509938, -5.150858513432233), 
        Point2f(10.240024837214303, 9.719775173985296), 
        Point2f(2.285841278954558, -7.22878356281036), 
        Point2f(4.521000197756237, 10.979081414379182), 
        Point2f(-1.280092648668831, -6.115930444896678), 
        Point2f(9.497627480224256, 10.499261966392726), 
        Point2f(-4.067895170205784, -2.9685826703702567), 
        Point2f(6.17134852170299, 11.756416185024266), 
        Point2f(2.8486740826745893, -6.2630509499238585), 
        Point2f(-0.37973260828469646, 10.98372783732616), 
        Point2f(-2.5847314531366745, 0.5715053784241357), 
        Point2f(11.060064179549517, 4.401351407064664), 
        Point2f(-0.306428132624299, -2.126140758444736), 
        Point2f(2.5578147551018096, 10.06675687471904), 
        Point2f(6.862114054115636, -1.8633657165571726), ], 
        d3vel = [Point2f(-6.440951025914804, -6.176324202525377), 
        Point2f(6.80775954892866, 7.6693443491148034), 
        Point2f(-5.725186195541469, -7.6108035688641875), 
        Point2f(5.361369598355603, 9.898955506712339), 
        Point2f(-3.4382112455310923, -8.964430653853048), 
        Point2f(6.510349512878963, 6.279002698738353), 
        Point2f(-7.321937913216385, -6.77948463809931), 
        Point2f(4.028509159245205, 8.247082363595139), 
        Point2f(-1.989301236918423, -9.480201971925734), 
        Point2f(1.4072873652330529, 7.6868960834382385), 
        Point2f(-5.252801184450994, -7.267304513432233), 
        Point2f(6.182413837214303, 7.127467873985296), 
        Point2f(-2.208830021045442, -8.55416496281036), 
        Point2f(1.407369197756237, 8.605699414379183), 
        Point2f(-1.643406748668831, -6.948439844896678), 
        Point2f(5.220822080224257, 6.0682812663927255), 
        Point2f(-6.906157170205783, -6.7318391703702565), 
        Point2f(3.17884352170299, 8.681109985024266), 
        Point2f(-0.6573472173254106, -7.652491349923858), 
        Point2f(-0.7167216082846964, 6.615014437326161), 
        Point2f(-6.001848453136675, -3.8491389215758645), 
        Point2f(6.629728679549516, 3.4232114070646635), 
        Point2f(-4.056238832624299, -6.829381758444736), 
        Point2f(0.39148655510180935, 5.760722874719041), 
        Point2f(2.0522132541156353, -5.054709716557173), ]
      )
    end 

    @testset "case2" begin 
      g, pos = initgrid()
      test_sim(ForceSimulation(pos, vertices(g); 
        link=LinkForce(edges=edges(g), strength=1, distance=20, iterations=5), 
        );
      d3pos = [Point2f(-3.3245472779234477, -0.7843089033085806), 
        Point2f(5.89859956589116, 8.392889013341104), 
        Point2f(-2.4658781577866535, -2.1313697174875537), 
        Point2f(4.737808042565102, 7.5104963790562245), 
        Point2f(0.7611659689559747, -2.927913901127913), 
        Point2f(6.938033992372833, 7.707128776348669), 
        Point2f(-2.484173743440433, -0.126291659919052), 
        Point2f(4.720176213450422, 8.461027183443802), 
        Point2f(2.9725219124196065, -3.23417012794705), 
        Point2f(2.420798206764892, 8.612888028451207), 
        Point2f(0.9620239912345947, -2.823296261341196), 
        Point2f(7.5149796138632, 7.248691496807689), 
        Point2f(2.8215513499059766, -3.924584293427451), 
        Point2f(4.094372070073858, 8.484592580609112), 
        Point2f(-0.7972557564349454, -3.957134388834164), 
        Point2f(7.626959446291536, 8.102347919038314), 
        Point2f(-1.488563914083152, -0.8969745040462369), 
        Point2f(5.323612380711253, 8.395951576673951), 
        Point2f(2.910725548462931, -3.6001605466554114), 
        Point2f(-0.07211785418647038, 9.250958587790667), 
        Point2f(-1.9568714047737412, 0.6392654840409153), 
        Point2f(9.726148805240133, 3.892548566925247), 
        Point2f(-0.3190380703550626, -1.6826771570745551), 
        Point2f(2.44102505981799, 9.745784001504429), 
        Point2f(6.89274320389123, -2.2043931122607106), ], 
      d3vel = [Point2f(-3.799082827923448, -3.5106954033085804), 
        Point2f(4.40665976589116, 4.651670413341105), 
        Point2f(-3.4288330977866535, -3.6924833174875538), 
        Point2f(4.054975842565102, 6.2672006790562245), 
        Point2f(-2.5245417310440255, -6.113858201127913), 
        Point2f(4.177653492372833, 4.066117076348669), 
        Point2f(-4.711644643440433, -4.200303959919052), 
        Point2f(3.453305713450422, 5.164306183443802), 
        Point2f(-1.5299460875803939, -6.11438362794705), 
        Point2f(1.0692851067648916, 5.732059928451207), 
        Point2f(-3.6662867087654054, -4.939742261341196), 
        Point2f(3.4573686138632, 4.656384196807689), 
        Point2f(-1.673119950094024, -5.249965693427451), 
        Point2f(0.9807410700738579, 6.111210580609112), 
        Point2f(-1.1605698564349454, -4.789643788834164), 
        Point2f(3.3501540462915362, 3.6713672190383133), 
        Point2f(-4.326825914083152, -4.660231004046237), 
        Point2f(2.3311073807112535, 5.320645376673952), 
        Point2f(-0.5952957515370693, -4.989600946655411), 
        Point2f(-0.40910685418647036, 4.882245187790668), 
        Point2f(-5.373988404773741, -3.781378815959085), 
        Point2f(5.295813305240132, 2.9144085669252466), 
        Point2f(-4.068848770355062, -6.385918157074555), 
        Point2f(0.2746968598179898, 5.4397500015044296), 
        Point2f(2.0828424038912297, -5.3957371122607105), ]
      )
    end 

    @testset "case3" begin 
      g, pos = initgrid()
      test_sim(ForceSimulation(pos, vertices(g); 
        link=LinkForce(edges=edges(g), distance=20, iterations=4), 
        );
        d3pos = [Point2f(-3.469165627949963, -0.8311708114229415), 
          Point2f(5.155566719810249, 8.13339025133682), 
          Point2f(-1.2993304184848737, -4.0943762353771245), 
          Point2f(-2.349521732045157, 6.29579313610429), 
          Point2f(8.798814969769918, 0.6701223547548789), 
          Point2f(6.601391914128325, 7.747288007024977), 
          Point2f(-2.3025123719537177, -0.6762224462987696), 
          Point2f(1.466321189145842, 8.912959768938837), 
          Point2f(9.161271882648279, -0.3305104367792544), 
          Point2f(-3.0051381694890624, 5.7388538717641335), 
          Point2f(2.0352650480855723, -3.1289773458921486), 
          Point2f(7.618991804495266, 7.390017618129205), 
          Point2f(5.513817081462501, -3.8746388123515607), 
          Point2f(-0.23308261509129435, 7.252276366839931), 
          Point2f(2.9326774064555297, -4.455268055783812), 
          Point2f(7.647268194290955, 8.770291191955938), 
          Point2f(-1.7609729452315208, -0.15043281242752427), 
          Point2f(3.4140460456464647, 9.418231518998795), 
          Point2f(5.57458130365433, -3.1658696489831506), 
          Point2f(-2.283910757866974, 8.00421311495209), 
          Point2f(-1.8395491719637649, 1.5901911596006282), 
          Point2f(10.928525425326406, 2.2512742180666376), 
          Point2f(1.309483434177864, -1.6673496841673776), 
          Point2f(0.23116667999740526, 9.516206620728173), 
          Point2f(8.538365724012154, -0.37811497113449066), ], 
        d3vel = [Point2f(-3.943701177949963, -3.5575573114229413), 
          Point2f(3.6636269198102496, 4.39217165133682), 
          Point2f(-2.2622853584848737, -5.655489835377124), 
          Point2f(-3.032353932045157, 5.05249743610429), 
          Point2f(5.513107269769917, -2.515821945245121), 
          Point2f(3.8410114141283245, 4.106276307024977), 
          Point2f(-4.529983271953718, -4.750234746298769), 
          Point2f(0.19945068914584213, 5.616238768938838), 
          Point2f(4.65880388264828, -3.2107239367792544), 
          Point2f(-4.3566512694890625, 2.858025771764134), 
          Point2f(-2.593045651914428, -5.245423345892148), 
          Point2f(3.561380804495267, 4.797710318129205), 
          Point2f(1.019145781462501, -5.200020212351561), 
          Point2f(-3.346713615091294, 4.878894366839932), 
          Point2f(2.5693633064555295, -5.287777455783812), 
          Point2f(3.370462794290956, 4.339310491955938), 
          Point2f(-4.599234945231521, -3.913689312427524), 
          Point2f(0.4215410456464649, 6.3429253189987955), 
          Point2f(2.06856000365433, -4.55531004898315), 
          Point2f(-2.620899757866974, 3.6354997149520907), 
          Point2f(-5.256666171963765, -2.830453140399372), 
          Point2f(6.498189925326407, 1.2731342180666376), 
          Point2f(-2.4403272658221358, -6.370590684167378), 
          Point2f(-1.935161520002595, 5.210172620728174), 
          Point2f(3.7284649240121532, -3.5694589711344906), ]
      )
    end

    @testset "case4 - 1 step" begin 
      g, pos = initgrid()
      test_sim(ForceSimulation(pos, vertices(g); 
        link=LinkForce(edges=edges(g), iterations=3), 
        ); 
        steps = 1, 
        d3pos = [Point2f(-5.8359510532756955, -3.119281922553579), 
          Point2f(7.346168702857163, 10.483206742537758), 
          Point2f(-3.6637919611674596, -5.729130857754015), 
          Point2f(1.5658120709830377, 10.941740327116442), 
          Point2f(4.776020025677243, -6.527950125320289), 
          Point2f(8.813826920914746, 9.769968985251495), 
          Point2f(-4.358556690468158, -2.446211938631399), 
          Point2f(3.623066793746944, 11.57242033382742), 
          Point2f(7.000590334462917, -5.709398235855176), 
          Point2f(-1.191422237328955, 10.842982013997949), 
          Point2f(-0.1109326616594597, -5.235487748063701), 
          Point2f(9.758770838137085, 9.291075200283164), 
          Point2f(4.060375612021622, -6.932583396662638), 
          Point2f(1.6049082935258931, 10.892083706794224), 
          Point2f(0.913016360605754, -7.303364633445146), 
          Point2f(9.515001570313835, 11.08172234497355), 
          Point2f(-3.8107953564406194, -2.2883226034575213), 
          Point2f(4.8076753379165655, 12.02618839808806), 
          Point2f(4.951302927379738, -6.506593776595333), 
          Point2f(-2.444687925150272, 11.596091307751593), 
          Point2f(-4.140681119350706, -0.7902674652910386), 
          Point2f(12.980145689828193, 4.93750849011238), 
          Point2f(-0.15567559195371095, -3.9874126159826826), 
          Point2f(0.7426377273241456, 12.464699299266723), 
          Point2f(9.249342228034662, -3.8839427460602156), ], 
        d3vel = [Point2f(-6.310486603275695, -5.845668422553579), 
          Point2f(5.854228902857163, 6.741988142537759), 
          Point2f(-4.62674690116746, -7.290244457754015), 
          Point2f(0.8829798709830377, 9.69844462711644), 
          Point2f(1.490312325677243, -9.713894425320289), 
          Point2f(6.053446420914747, 6.128957285251496), 
          Point2f(-6.586027590468158, -6.520224238631399), 
          Point2f(2.356196293746944, 8.27569933382742), 
          Point2f(2.4981223344629164, -8.589611735855176), 
          Point2f(-2.542935337328955, 7.962153913997948), 
          Point2f(-4.73924336165946, -7.351933748063701), 
          Point2f(5.7011598381370865, 6.698767900283165), 
          Point2f(-0.4342956879783777, -8.257964796662637), 
          Point2f(-1.5087227064741067, 8.518701706794225), 
          Point2f(0.549702260605754, -8.135874033445146), 
          Point2f(5.238196170313834, 6.650741644973548), 
          Point2f(-6.649057356440619, -6.051579103457521), 
          Point2f(1.815170337916566, 8.95088219808806), 
          Point2f(1.4452816273797386, -7.896034176595332), 
          Point2f(-2.781676925150272, 7.227377907751594), 
          Point2f(-7.557798119350706, -5.210911765291039), 
          Point2f(8.549810189828193, 3.9593684901123805), 
          Point2f(-3.9054862919537108, -8.690653615982683), 
          Point2f(-1.4236904726758546, 8.158665299266723), 
          Point2f(4.4394414280346615, -7.075286746060216), ]
      )
    end 

    @testset "case4 - 2 steps" begin 
      g, pos = initgrid()
      test_sim(ForceSimulation(pos, vertices(g); 
        link=LinkForce(edges=edges(g), iterations=3), 
        ); 
        steps = 2, 
        d3pos = [Point2f(-8.035262426693496, -5.086444454491533), 
          Point2f(9.578850557569424, 13.009344002074151), 
          Point2f(-5.558572925172668, -8.39392588430575), 
          Point2f(2.199342159075976, 14.922627168368077), 
          Point2f(5.250392185033552, -10.058968947153124), 
          Point2f(11.25059105350537, 12.26054552551814), 
          Point2f(-7.216081702104267, -5.281799605697552), 
          Point2f(4.812787917025695, 15.287396220283615), 
          Point2f(8.09728335159283, -9.385873026097858), 
          Point2f(-2.2441645978405864, 14.094103950583936), 
          Point2f(-2.1264223253763976, -8.409855121754266), 
          Point2f(12.149724007389986, 12.234230018018746), 
          Point2f(3.8393631564741177, -10.416999463273301), 
          Point2f(0.8879504160193351, 14.65971157026279), 
          Point2f(1.0896295401521556, -10.84288108747732), 
          Point2f(11.44395254829974, 13.668547178184646), 
          Point2f(-6.4795824453106405, -4.879744161173191), 
          Point2f(5.641092258328568, 15.740997321568448), 
          Point2f(5.52761848408907, -9.651621328730918), 
          Point2f(-3.5007479995621136, 14.451524274915188), 
          Point2f(-7.0935008719705905, -3.016610488836278), 
          Point2f(16.584429982758458, 6.583122138347939), 
          Point2f(-2.2478697062796473, -8.295144155822396), 
          Point2f(0.18607388009603087, 16.054572269798843), 
          Point2f(11.163976235782538, -6.834782987487397), ], 
        d3vel = [Point2f(-2.1993113734178005, -1.9671625319379533), 
          Point2f(2.2326818547122618, 2.5261372595363927), 
          Point2f(-1.8947809640052087, -2.6647950265517344), 
          Point2f(0.6335300880929383, 3.9808868412516345), 
          Point2f(0.47437215935630833, -3.5310188218328356), 
          Point2f(2.436764132590625, 2.4905765402666438), 
          Point2f(-2.8575250116361084, -2.8355876670661533), 
          Point2f(1.1897211232787508, 3.7149758864561937), 
          Point2f(1.0966930171299136, -3.6764747902426835), 
          Point2f(-1.0527423605116313, 3.2511219365859865), 
          Point2f(-2.015489663716938, -3.1743673736905644), 
          Point2f(2.3909531692529016, 2.9431548177355817), 
          Point2f(-0.2210124555475047, -3.4844160666106636), 
          Point2f(-0.716957877506558, 3.767627863468565), 
          Point2f(0.17661317954640174, -3.539516454032174), 
          Point2f(1.9289509779859042, 2.586824833211096), 
          Point2f(-2.6687870888700216, -2.5914215577156696), 
          Point2f(0.8334169204120019, 3.714808923480389), 
          Point2f(0.5763155567093314, -3.145027552135586), 
          Point2f(-1.0560600744118416, 2.855432967163596), 
          Point2f(-2.9528197526198845, -2.2263430235452395), 
          Point2f(3.6042842929302665, 1.645613648235559), 
          Point2f(-2.0921941143259364, -4.307731539839713), 
          Point2f(-0.5565638472281147, 3.5898729705321197), 
          Point2f(1.9146340077478763, -2.9508402414271813), ]
      )
    end 
  end 
end 